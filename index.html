<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Imagine Church • Missions Kiosk (Portrait 1080×1920)</title>
  <!-- Prefer local Tailwind for offline use; fallback to CDN if missing -->
  <link rel="stylesheet" href="tailwind.min.css">
  <script>
    (function(){
      var probe=document.createElement('div');
      probe.className='hidden h-10 w-10 bg-emerald-700';
      document.body?document.body.appendChild(probe):document.addEventListener('DOMContentLoaded',function(){document.body.appendChild(probe)});
      setTimeout(function(){
        if(!getComputedStyle(probe).backgroundColor || getComputedStyle(probe).backgroundColor==='rgba(0, 0, 0, 0)'){
          var s=document.createElement('script');
          // Use local tailwind.cdn.js when offline; CDN as a secondary fallback
          s.src='tailwind.cdn.js';
          s.onerror=function(){
            var cdn=document.createElement('script');
            cdn.src='https://cdn.tailwindcss.com';
            document.head.appendChild(cdn);
          };
          document.head.appendChild(s);
        }
        probe.remove();
      },0);
    })();
  </script>
  <!-- Local QR generator for offline use -->
  <script src="scripts/vendor/qrcode.min.js"></script>
  <style>
    :root{
      /* Theme variables (overridden by selected preset) */
      --brand:#62b37a;
      --brand-700:#3b8d5e;
      --brand-900:#1f5d3f;
      --on-brand:#06130d;
      --surface:#0b1220;
      --surface-2:#0f172a;
      --on-surface:#d1fae5;
      --text-base:#d1fae5;
      --text-muted:#99f6e4;
      --text-subtle:#a7f3d0;
      --bg-gradient:linear-gradient(180deg,#022c22 0%,#02131b 55%,#031c28 100%);
    }
    html, body{
      background:var(--bg-gradient);
      color:var(--text-base);
    }
    body{
      touch-action:pan-y;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      scrollbar-width: thin;
    }
    body::-webkit-scrollbar{ width:8px; }
    body::-webkit-scrollbar-thumb{
      background: rgba(148,163,184,0.35);
      border-radius:999px;
    }
    body::-webkit-scrollbar-track{
      background: rgba(15,23,42,0.55);
    }
    #introScreen,
    header,
    #homeView,
    #detailView,
    footer,
    #qrModal,
    #webModal,
    #viewRoot,
    #osk{
      user-select:none;
      -webkit-user-select:none;
      -webkit-touch-callout:none;
    }
    input, textarea, select,
    [contenteditable="true"],
    .allow-text-selection{
      user-select:text;
      -webkit-user-select:text;
      -webkit-touch-callout:default;
    }
    .touch{
      min-height:84px;
      touch-action:pan-y;
    }
    .mission-card,
    #grid{
      touch-action:pan-y;
    }
    ::-webkit-scrollbar{width:0;height:0}
    /* Portrait guidance: constrain main content to 1080px width for 1080×1920 portrait displays */
    .portrait-wrap{max-width:1080px;margin:0 auto}
    /* Brand overrides to avoid chasing utility classes */
    header, footer{ border-color: var(--brand-700) !important; }
    #dLinks a{ background-color: var(--brand) !important; color: var(--on-brand) !important; }
    #highlight{ border-color: var(--brand-700) !important; background-color: rgba(11,18,32,0.7) !important; }
    #detailView .rounded-3xl{ border-color: var(--brand-700) !important; }
    #qrModal .rounded-3xl{ border-color: var(--brand-700) !important; }
    /* Cards */
    .mission-card{ border-color: var(--brand-700) !important; background-color: rgba(15,23,42,0.7) !important; }
    .mission-chip{ border-color: var(--brand-700) !important; background-color: rgba(15,23,42,0.5) !important; }
    /* Text tints */
    .t-subtle{ color: var(--text-subtle) !important; }
    .t-muted{ color: var(--text-muted) !important; }
    /* Uniform CTA button style */
    .btn{ padding: clamp(0.9rem,1.6vw,1.25rem) clamp(1.25rem,2.6vw,2rem); border-radius: 9999px; font-weight: 700; font-size: clamp(1rem,1.8vw,1.375rem); box-shadow: 0 10px 20px rgba(0,0,0,.25); border: 1px solid transparent; transition: transform .15s ease, filter .2s ease; backdrop-filter: saturate(120%); }
    .btn:active{ transform: scale(0.98); }
    .btn-primary{ background: var(--brand); color: var(--on-brand); border-color: rgba(255,255,255,.08); }
    .btn-secondary{ background: rgba(255,255,255,0.08); color: var(--on-surface); border-color: rgba(255,255,255,0.16); }
    .btn-ghost{ background: transparent; color: var(--on-surface); border-color: rgba(255,255,255,0.15); }
    .btn-danger{ background: #f87171; color: #111; border-color: #fecaca; }
    .btn-footer{ padding: 0.55rem 1rem; font-size: clamp(0.9rem, 1.2vw, 1.05rem); }
    .footer-settings{
      background: rgba(94,234,212,0.15);
      border-color: rgba(34,197,94,0.45);
      color: var(--text-base);
      backdrop-filter: saturate(140%);
      box-shadow: 0 10px 20px rgba(0,0,0,0.25);
    }
    .input-field, .textarea-field, .select-field{
      width: 100%;
      border-radius: 1rem;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(148,163,184,0.25);
      padding: 0.75rem 1rem;
      color: var(--on-surface);
      font-size: 1rem;
    }
    .textarea-field{ min-height: 5rem; resize: vertical; }
    .admin-card{ border-radius: 1.5rem; background: rgba(15,23,42,0.75); border: 1px solid rgba(255,255,255,0.12); padding: 1.25rem; box-shadow: 0 15px 30px rgba(0,0,0,0.25); }
    .admin-drop{
      border: 2px dashed rgba(148,163,184,0.4);
      border-radius: 1.5rem;
      min-height: 170px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
      padding: 1.5rem;
      text-align: center;
      color: var(--text-muted);
      background: rgba(15,23,42,0.35);
      transition: border-color .2s ease, background .2s ease;
    }
    .admin-drop.dragover{
      border-color: var(--brand);
      background: rgba(31,41,55,0.6);
      color: var(--on-surface);
    }
    /* Drag highlight when dropping files onto a mission row */
    .admin-card.dragover{ border-color: var(--brand); background: rgba(31,41,55,0.6); }
    /* On-screen keyboard */
    #osk{ background: rgba(2,6,23,0.9); border-top: 1px solid rgba(16,185,129,0.25); box-shadow: 0 -15px 30px rgba(0,0,0,0.35); }
    #osk.osk--min .osk-wrap{ padding: 6px 12px; }
    .osk-wrap{ max-width:1080px; margin:0 auto; padding: 8px 16px; }
    .osk-row{ display:flex; gap:8px; justify-content:center; margin:6px 0; }
    #osk.osk--min .osk-row{ display:none; }
    .osk-key{ user-select:none; -webkit-user-select:none; padding:14px 12px; min-width:42px; border-radius:10px; background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.14); color: var(--on-surface); font-weight:700; font-size:20px; text-align:center; box-shadow: 0 6px 14px rgba(0,0,0,.2); }
    .osk-key:active{ transform: scale(0.98); }
    .osk-key--wide{ min-width: 84px; }
    .osk-key--space{ flex:1; min-width: 140px; }
    .osk-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:4px; color: var(--text-muted); font-size: 12px; }
    .osk-hide{ background: transparent; color: var(--text-muted); border: 1px solid rgba(255,255,255,0.12); padding: 6px 10px; border-radius: 999px; font-weight:600; }
    body.osk-open #adminModal .admin-panel{ margin-bottom: 320px; }
    #oskShowBtn{
      position: fixed;
      right: 24px;
      bottom: 110px;
      z-index: 55;
      background: rgba(15,23,42,0.92);
      color: var(--text-muted);
      border: 1px solid rgba(16,185,129,0.35);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.35);
    }
    #oskShowBtn.hidden{ display: none; }
    body.osk-open #oskShowBtn{ display: none; }
    .display-title{ font-size: clamp(2.25rem, 4.5vw, 4.75rem); line-height: 1.1; }
    .display-lead{ font-size: clamp(1.125rem, 2.25vw, 1.85rem); line-height: 1.45; }
    .display-h2{ font-size: clamp(1.75rem, 3vw, 2.75rem); line-height: 1.15; }
    .admin-icon-btn{
      padding: 0.4rem 0.85rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      color: var(--on-surface);
      border: 1px solid rgba(255,255,255,0.16);
      font-weight: 600;
      font-size: 0.85rem;
      transition: transform .15s ease, filter .2s ease;
    }
    .admin-icon-btn:active{ transform: scale(0.95); }
    .admin-icon-btn--danger{ background:#f87171; color:#111; border-color:#fecaca; }
    /* Force mission images to fill their frames consistently */
    #hlImage, #dImage, .mission-visual{ width:100%; height:100%; object-fit:cover; object-position:center; }
    #introScreen{
      background:
        radial-gradient(120% 120% at 50% -20%, rgba(99, 255, 210, 0.25), rgba(3, 17, 25, 0)),
        var(--bg-gradient);
      padding: clamp(2.5rem, 6vw, 4.5rem) clamp(2rem, 5vw, 3.5rem);
    }
    .intro-panel{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: clamp(1.8rem, 3.5vw, 3.2rem);
      padding: clamp(2.8rem, 6vw, 4.5rem);
      border-radius: 3rem;
      background: rgba(5, 21, 32, 0.72);
      border: 1px solid rgba(99, 255, 210, 0.22);
      box-shadow: 0 40px 90px rgba(0,0,0,0.45), 0 0 80px rgba(59, 230, 190, 0.18);
      backdrop-filter: blur(22px);
      max-width: clamp(28rem, 60vw, 38rem);
    }
    .intro-media{ width: clamp(12rem, 38vw, 19rem); height: clamp(12rem, 38vw, 19rem); border-radius: 2rem; overflow: hidden; border: 2px solid rgba(99,255,210,0.35); background: rgba(15,23,42,0.85); display:flex; align-items:center; justify-content:center; box-shadow: 0 20px 45px rgba(0,0,0,0.35); }
    .intro-media img{ width:100%; height:100%; object-fit:cover; }
    .intro-media.hidden{ display:none; }
    .intro-copy{ text-align:center; max-width: clamp(24rem, 52vw, 34rem); }
    .intro-title{ font-size: clamp(3rem, 6.8vw, 5.8rem); line-height: 1.05; }
    .intro-subtitle{ font-size: clamp(1.4rem, 2.6vw, 2.05rem); line-height: 1.45; color: rgba(215, 245, 255, 0.95); }
    .intro-cta{ font-size: clamp(1.4rem, 2.4vw, 2rem); padding: clamp(1.2rem, 2.2vw, 1.9rem) clamp(2.8rem, 5.8vw, 4.8rem); border-radius: 999px; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18), rgba(255,255,255,0)); }
    .intro-cta:active{ transform: scale(0.97); }
    .intro-hint{ font-size: clamp(0.95rem, 1.5vw, 1.2rem); color: rgba(186, 248, 233, 0.8); }
    .splash-preview{ width: 96px; height: 96px; border-radius: 1rem; overflow:hidden; border:1px solid rgba(16,185,129,0.4); background: rgba(15,23,42,0.6); display:flex; align-items:center; justify-content:center; }
    .splash-preview img{ width:100%; height:100%; object-fit:cover; }
    @keyframes hero-pan {
      0%{ transform: scale(1.05) translateX(-1.5%); }
      50%{ transform: scale(1.08) translateX(1.5%); }
      100%{ transform: scale(1.05) translateX(-1.5%); }
    }
    @keyframes card-fade-up {
      from{ opacity:0; transform: translateY(18px) scale(0.96); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    @keyframes glow-pulse {
      0%,100%{ box-shadow: 0 25px 60px rgba(0,0,0,0.25); }
      50%{ box-shadow: 0 35px 80px rgba(0,0,0,0.32); }
    }
    .hero-img{
      min-height: clamp(15rem, 24vh, 26rem);
      position: relative;
      overflow: hidden;
      border-radius: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15,23,42,0.65);
    }
    .hero-img::after{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(180deg,rgba(4,20,16,0) 0%,rgba(4,20,16,0.55) 100%);
      pointer-events:none;
    }
    .hero-img img{
      width:auto;
      height:auto;
      max-width:100%;
      max-height:100%;
      display:block;
      object-fit:contain;
      animation:none;
      transform:none;
    }
    #highlight{ animation: glow-pulse 16s ease-in-out infinite; }
    .mission-card{
      animation: card-fade-up 0.72s ease both;
      transition: transform .4s cubic-bezier(0.22,1,0.36,1), box-shadow .4s ease, filter .4s ease;
    }
    .mission-card:nth-child(2n){ animation-delay: 0.08s; }
    .mission-card:nth-child(3n){ animation-delay: 0.16s; }
    .mission-card:hover,
    .mission-card:focus-visible{
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 28px 60px rgba(0,0,0,0.28);
      outline: none;
    }
    .mission-card:hover .mission-chip,
    .mission-card:focus-visible .mission-chip{
      filter: saturate(125%);
    }
    @media (prefers-reduced-motion: reduce){
      .hero-img img,
      .mission-card,
      #highlight{ animation: none !important; }
      .mission-card{ transition: none; }
    }
    @media (min-height: 1700px){
      .mission-chip{ width: 7.5rem; height: 7.5rem; }
    }
    @keyframes tap-bounce {
      0%,100%{transform:translateY(0) scale(1);}
      28%{transform:translateY(-3px) scale(1.02);}
      52%{transform:translateY(0) scale(0.985);}
      72%{transform:translateY(-1px) scale(1.01);}
    }
    .bounce-once{animation:tap-bounce 0.5s cubic-bezier(0.3,1.4,0.48,1) forwards;}
    .mission-card-title{ font-size: clamp(1.6rem, 3vw, 2.45rem); line-height: 1.1; }
    .mission-card-subtitle{ font-size: clamp(1.1rem, 2.3vw, 1.6rem); }
    .mission-chip{ width: clamp(7.2rem, 12vw, 8.6rem); height: clamp(7.2rem, 12vw, 8.6rem); }
    .mission-detail-label{ font-size: clamp(1rem, 1.8vw, 1.4rem); font-weight: 600; color: rgba(153,246,228,0.8); }
    .mission-detail-text{ font-size: clamp(1.1rem, 2.1vw, 1.6rem); }
  </style>
</head>
<body class="min-h-screen">
  <div id="introScreen" class="fixed inset-0 z-50 flex items-center justify-center px-6 py-10 md:px-10">
    <div class="intro-panel text-center">
      <div class="intro-media" id="introMedia">
        <img id="introImage" src="images/general/logo.png" alt="Imagine Church logo" />
      </div>
      <div class="intro-copy space-y-4">
        <h1 id="introTitle" class="intro-title font-black tracking-tight">Imagine Serving Others</h1>
        <p id="introSubtitle" class="intro-subtitle">Touch to discover stories of hope and find your place to serve.</p>
      </div>
      <div class="intro-actions flex flex-col items-center gap-3">
        <button id="startBtn" class="btn btn-primary touch intro-cta transition-transform duration-200 focus:outline-none focus:ring-4">
          Touch to Begin Exploring
        </button>
        <div class="intro-hint">Curious? Tap the button or anywhere on screen to start your journey.</div>
      </div>
    </div>
  </div>
  <!-- Persistent App Bar with Back + Home -->
  <header class="hidden sticky top-0 z-40 bg-slate-950/85 backdrop-blur border-b border-emerald-900/60">
    <div class="portrait-wrap px-5 py-3">
      <div class="flex justify-center gap-3">
        <button id="backBtn" class="btn btn-primary touch inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M15.75 19.5 8.25 12l7.5-7.5"/></svg>
          <span>Back</span>
        </button>
        <button id="homeBtn" class="btn btn-primary touch inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M2.25 12 12 3l9.75 9v8.25a.75.75 0 0 1-.75.75H3a.75.75 0 0 1-.75-.75z"/></svg>
          <span>Home</span>
        </button>
      </div>
    </div>
    <!-- Announcements ribbon -->
    <div id="announceBar" class="hidden border-t border-emerald-900/60">
      <div class="portrait-wrap px-5 py-2 text-sm text-teal-100/90"><span id="announceText"></span></div>
    </div>
  </header>

  <!-- Views Container -->
  <main id="viewRoot" class="hidden min-h-[calc(100dvh-64px)]">
    <!-- Home View (portrait optimized) -->
    <section id="homeView" class="portrait-wrap px-5 py-6 pb-28 md:pb-32">
      <div class="flex flex-col items-center text-center gap-5">
        <img id="logo" alt="Imagine Church Logo" class="h-28 md:h-36 object-contain"/>
        <h1 class="display-title font-black tracking-tight">imagine serving others</h1>
        <p class="display-lead text-teal-100/90 max-w-2xl">Tap a card to learn how you can pray, give, or serve with each mission.</p>
      </div>

      <!-- Dynamic hero / rotating highlights -->
      <div id="highlight" class="mt-6 rounded-3xl border border-emerald-700/40 bg-slate-900/70 p-5 shadow-xl shadow-emerald-950/30">
        <div class="flex flex-col items-center gap-5 xl:flex-row xl:items-stretch xl:gap-8">
          <div class="hero-img w-full shrink-0 rounded-2xl bg-emerald-900/60 overflow-hidden xl:w-[46%] xl:max-h-[26rem]">
            <img id="hlImage" class="w-full h-full object-cover" alt="Mission highlight"/>
          </div>
          <div class="w-full text-center xl:flex-1 xl:text-left xl:flex xl:flex-col xl:justify-center">
            <h2 id="hlTitle" class="display-h2 font-bold"></h2>
            <p id="hlBlurb" class="mt-2 display-lead text-teal-100/90"></p>
            <div class="mt-4 flex flex-wrap gap-3 justify-center xl:justify-start">
              <button id="hlOpen" class="btn btn-primary touch">Explore</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Missions Grid (1-col portrait, expands if wider) -->
      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-5" id="grid"></div>
    </section>

    <!-- Detail View -->
    <section id="detailView" class="hidden">
      <div class="portrait-wrap px-5 py-6">
        <div class="rounded-3xl border border-emerald-700/40 bg-slate-950/70 overflow-hidden shadow-2xl shadow-emerald-950/40">
          <div class="flex flex-col">
            <div class="min-h-[320px] md:min-h-[440px] bg-emerald-900/60 overflow-hidden">
              <img id="dImage" class="w-full h-full object-cover" alt="Mission image"/>
            </div>
            <div class="p-7 md:p-8 space-y-6">
              <div class="flex items-start justify-between gap-4">
                <div class="space-y-3">
                  <h2 id="dTitle" class="display-h2 font-bold"></h2>
                  <p id="dSubtitle" class="display-lead text-teal-100/90"></p>
                </div>
                <div class="text-right text-teal-200/70 text-base md:text-lg">
                  <div id="dViews" class="">Views: 0</div>
                </div>
              </div>
              <div class="grid grid-cols-1 gap-4 mission-detail-text">
                <div class="space-y-2">
                  <div class="mission-detail-label">Mission Focus</div>
                  <div id="dFocus" class="mission-detail-text"></div>
                </div>
                <div class="space-y-2">
                  <div class="mission-detail-label">How to Get Involved</div>
                  <div id="dInvolved" class="mission-detail-text"></div>
                </div>
                <div class="space-y-2">
                  <div class="mission-detail-label">Contact</div>
                  <div id="dContact" class="mission-detail-text"></div>
                </div>
              </div>
              <div class="pt-2 flex flex-wrap gap-3" id="dLinks"></div>
              <div class="pt-2">
                <button id="qrBtn" class="btn btn-primary touch text-lg">Show me a QR Code</button>
              </div>
            </div>
          </div>
          <div class="p-7 md:p-8 border-t border-emerald-900/60 space-y-3">
            <h3 class="text-2xl md:text-3xl font-semibold">About this Mission</h3>
            <p id="dBody" class="mission-detail-text text-teal-100/90"></p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- QR Modal -->
  <div id="qrModal" class="fixed inset-0 hidden z-[70] flex items-center justify-center">
    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm" data-close="qr"></div>
    <div class="relative w-[320px] max-w-[90vw] rounded-3xl bg-slate-950/90 border border-emerald-800/50 p-3 shadow-2xl shadow-emerald-950/40">
      <button class="admin-icon-btn absolute right-3 top-3" data-close="qr" aria-label="Close">✕</button>
      <div class="flex items-center justify-center py-2">
        <h4 class="text-base font-bold">Scan to open</h4>
      </div>
      <div class="flex items-center justify-center">
        <div id="qrCanvasWrap" class="rounded-2xl bg-white p-2 shadow-lg shadow-emerald-950/20">
          <canvas id="qrCanvas" width="240" height="240"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Web Modal (in-app browser) -->
  <div id="webModal" class="fixed inset-0 hidden">
    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm" data-close="web"></div>
    <div class="absolute inset-x-0 bottom-0 sm:inset-0 sm:m-auto sm:h-[80vh] sm:w-[900px] rounded-t-3xl sm:rounded-3xl bg-slate-950/90 border border-emerald-800/50 p-0 shadow-2xl shadow-emerald-950/40 overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 border-b border-emerald-900/60">
        <h4 class="text-base md:text-lg font-bold">In-App View</h4>
        <button class="btn btn-secondary touch" data-close="web">Close</button>
      </div>
      <div class="relative h-[65vh] sm:h-[calc(80vh-60px)] bg-white">
        <iframe id="webFrame" class="w-full h-full" style="background:#fff;" sandbox="allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-downloads"></iframe>
        <div id="webError" class="hidden absolute inset-0 flex items-center justify-center text-center px-6">
          <div class="rounded-xl border border-emerald-800/50 bg-slate-950/85 px-4 py-4 text-teal-100/90 text-sm space-y-3 max-w-lg">
            <div>Unfortunately this site is Unavailable in this Mode</div>
            <div class="text-teal-200/70 break-all" id="webErrorUrl"></div>
            <div class="flex items-center justify-center gap-2">
              <button id="webCopyBtn" class="btn btn-secondary touch">Copy Link</button>
              <button id="webQrBtn" class="btn btn-primary touch">Show QR</button>
            </div>
          </div>
        </div>
      </div>
      <div class="px-4 py-2 text-xs text-teal-200/70 border-t border-emerald-900/60">Tap Close to return.</div>
    </div>
  </div>

  <footer class="fixed bottom-0 left-0 right-0 bg-slate-950/85 border-t border-emerald-900/60">
    <div class="portrait-wrap px-5 py-2 flex items-center justify-between text-teal-200/70 text-sm gap-4">
      <span id="footerTip" class="flex-1">Tap Back or Home anytime • Idle reset after <span id="footerIdle">60</span>s</span>
      <button id="settingsBtn" class="btn btn-secondary btn-footer touch footer-settings">Settings</button>
    </div>
  </footer>

  <!-- Admin Modal (hidden; opens via 5-tap on header title) -->
  <div id="adminModal" class="fixed inset-x-0 top-[72px] bottom-0 hidden z-50">
    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm" data-close="admin"></div>
    <div class="relative h-full overflow-y-auto z-10">
      <div class="admin-panel mx-auto my-4 w-full max-w-[980px] rounded-3xl bg-slate-950/90 border border-emerald-800/50 p-6 space-y-5 shadow-2xl shadow-emerald-950/40 allow-text-selection">
        <div class="flex items-center justify-between">
          <h4 class="text-xl font-bold">Admin</h4>
          <button class="btn btn-secondary touch" data-close="admin">Close</button>
        </div>
        <div id="adminPinWrap" class="space-y-3">
          <label class="block text-sm text-teal-200/80">Enter PIN</label>
          <input id="adminPin" type="password" inputmode="numeric" class="input-field" placeholder="••••" />
          <button id="adminPinBtn" class="btn btn-primary touch">Unlock</button>
          <div id="adminPinMsg" class="text-sm text-red-300 hidden">Incorrect PIN</div>
        </div>
      <div id="adminBody" class="hidden text-sm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        <section class="md:col-span-2">
          <div id="adminSummary" class="grid grid-cols-1 sm:grid-cols-3 gap-3"></div>
        </section>

        <section class="space-y-3">
          <h5 class="text-base font-semibold text-teal-100/90">Content Source</h5>
          <p class="text-teal-200/80 text-xs sm:text-sm">Load missions from CSV (columns: id,title,subtitle,focus,involved,contact,body,image,links). Data stays on this kiosk.</p>
          <p class="text-teal-200/60 text-xs sm:text-sm">Drop mission images in <code>images/missions/</code> and shared graphics in <code>images/general/</code>. Reference them from CSV like <code>images/missions/your-photo.jpg</code>.</p>
          <input id="csvInput" type="file" accept=".csv,text/csv" class="input-field" />
          <div class="flex flex-wrap gap-3">
            <button id="adminSaveBtn" class="btn btn-primary touch">Apply & Save</button>
            <button id="adminDownloadBtn" class="btn btn-secondary touch">Download Current Data</button>
            <button id="adminClearBtn" class="btn btn-danger touch">Clear Stored Data</button>
          </div>
        </section>

        <section class="space-y-3">
          <h5 class="text-base font-semibold text-teal-100/90">Image Library</h5>
          <p class="text-teal-200/80 text-xs sm:text-sm">Chromium-only shortcut: pick your local folders once per session, then drag files in. Files save directly to the kiosk.</p>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="admin-card space-y-2">
              <div class="text-xs uppercase tracking-wide text-teal-200/70">Missions folder</div>
              <button id="pickMissionsDir" class="btn btn-secondary touch">Choose missions folder</button>
              <div id="missionsDirLabel" class="text-xs text-teal-200/70 truncate">Not selected</div>
            </div>
            <div class="admin-card space-y-2">
              <div class="text-xs uppercase tracking-wide text-teal-200/70">General images folder</div>
              <button id="pickGeneralDir" class="btn btn-secondary touch">Choose general folder</button>
              <div id="generalDirLabel" class="text-xs text-teal-200/70 truncate">Not selected</div>
            </div>
          </div>
          <div class="admin-card space-y-3">
            <div class="flex flex-wrap items-center gap-3">
              <label class="text-xs uppercase tracking-wide text-teal-200/70">Save to</label>
              <select id="imageTargetSelect" class="select-field max-w-[220px]">
                <option value="missions">Missions (images/missions)</option>
                <option value="general">General (images/general)</option>
              </select>
              <input id="imageFileInput" type="file" accept="image/*" multiple class="hidden" />
              <button id="imageFileBrowse" class="btn btn-secondary touch">Browse files</button>
            </div>
            <div id="imageDrop" class="admin-drop">
              <div class="text-sm font-semibold">Drop images here</div>
              <div class="text-xs">or click <span class="underline">Browse files</span></div>
              <div class="text-xs text-teal-200/60">Saved to <span id="imageTargetLabel">images/missions/</span></div>
            </div>
            <div id="imageStatus" class="text-xs text-teal-200/70"></div>
          </div>
        </section>

        <section class="space-y-3">
          <h5 class="text-base font-semibold text-teal-100/90">Kiosk Mode</h5>
          <p class="text-teal-200/80 text-xs sm:text-sm">Run the kiosk via http://localhost on Raspberry Pi to enable direct image uploads and a smoother experience.</p>
          <div class="flex flex-wrap gap-3">
            <button id="adminKioskCheck" class="btn btn-secondary touch">Run Environment Check</button>
            <button id="adminCopyStart" class="btn btn-secondary touch">Copy Start Command</button>
            <button id="adminCopyServe" class="btn btn-secondary touch">Copy Serve Command</button>
            <button id="adminOpenGuide" class="btn btn-secondary touch">Open Setup Guide</button>
            <a href="README_KIOSK.md" target="_blank" class="btn btn-ghost touch">Open in New Tab</a>
            <button id="adminExitBtn" class="btn btn-danger touch">Exit Kiosk</button>
          </div>
          <div id="adminKioskStatus" class="text-xs text-teal-200/70"></div>
          <div class="admin-card space-y-2">
            <div class="text-xs uppercase tracking-wide text-teal-200/70">Recommended</div>
            <pre id="adminKioskCmd" class="whitespace-pre-wrap text-teal-100/90 text-xs bg-slate-800/50 p-3 rounded-lg border border-emerald-800/40">./kiosk-start.sh 8080</pre>
            <div class="text-xs uppercase tracking-wide text-teal-200/70">Alternative (serve only)</div>
            <pre id="adminServeCmd" class="whitespace-pre-wrap text-teal-100/90 text-xs bg-slate-800/50 p-3 rounded-lg border border-emerald-800/40">python3 serve.py --port 8080 --dir .</pre>
            <div id="adminKioskGuide" class="hidden whitespace-pre-wrap text-teal-100/90 text-xs bg-slate-800/50 p-3 rounded-lg border border-emerald-800/40 max-h-80 overflow-y-auto"></div>
          </div>
        </section>

        <section class="space-y-3">
          <h5 class="text-base font-semibold text-teal-100/90">Web Embeds</h5>
          <p class="text-teal-200/80 text-xs sm:text-sm">Block domains from opening inside the kiosk (one per line). Useful for sites that disable embedding or show poorly inside the iframe. Applies after saving.</p>
          <label class="block space-y-2">
            <span class="text-teal-200/80">Blocked domains</span>
            <textarea id="adminWebBlocklist" class="textarea-field" rows="4" placeholder="e.g.\nwycliffe.org\nfacebook.com"></textarea>
          </label>
        </section>

        <section class="space-y-3">
          <h5 class="text-base font-semibold text-teal-100/90">Splash Screen</h5>
          <p class="text-teal-200/80 text-xs sm:text-sm">Update the welcome screen title, subtitle, and optional image shown before launching the kiosk.</p>
          <label class="block space-y-2">
            <span class="text-teal-200/80">Headline</span>
            <input id="adminSplashTitle" class="input-field" placeholder="Welcome headline" />
          </label>
          <label class="block space-y-2">
            <span class="text-teal-200/80">Subtitle</span>
            <textarea id="adminSplashSubtitle" class="textarea-field" rows="2" placeholder="Supporting message"></textarea>
          </label>
          <div class="admin-card space-y-3" id="adminSplashCard">
            <div class="flex items-start gap-3">
              <div class="splash-preview" id="adminSplashPreviewWrap">
                <div id="adminSplashPreviewEmpty" class="text-[10px] text-teal-200/60 px-1 text-center">No image</div>
                <img id="adminSplashPreview" class="hidden" alt="Splash preview" />
              </div>
              <div class="flex-1 space-y-2">
                <label class="block text-xs uppercase tracking-wide text-teal-200/70">
                  <span>Image path</span>
                  <input id="adminSplashImage" class="input-field" placeholder="images/general/welcome.jpg" />
                </label>
                <div class="flex flex-wrap gap-2">
                  <input id="adminSplashFile" type="file" accept="image/*" class="hidden" />
                  <button id="adminSplashChoose" class="btn btn-secondary touch">Choose Image</button>
                  <button id="adminSplashClear" class="btn btn-secondary touch">Remove Image</button>
                </div>
                <div class="text-xs text-teal-200/70" id="adminSplashStatus"></div>
              </div>
            </div>
            <div class="text-xs text-teal-200/60">Tip: drop or paste an image onto this card to upload it. Files save into your selected General images folder.</div>
          </div>
        </section>

        <section class="space-y-3">
          <h5 class="text-base font-semibold text-teal-100/90">Brand Logo</h5>
          <div id="adminLogoCard" class="admin-card flex items-center gap-3">
            <div class="splash-preview">
              <img id="adminLogoPreview" alt="Current logo" />
            </div>
            <div class="flex-1 flex items-center gap-2">
              <input id="adminLogoFile" type="file" accept="image/svg+xml,image/png" class="hidden" />
              <button id="adminLogoChoose" class="admin-icon-btn" title="Replace logo">Replace Logo</button>
              <div id="adminLogoStatus" class="text-xs text-teal-200/70"></div>
            </div>
          </div>
          <div class="text-xs text-teal-200/60">Tip: use an SVG for best clarity. You can also drag or paste a logo onto this card. Files save into your selected General images folder.</div>
        </section>

        <section class="space-y-3">
          <h5 class="text-base font-semibold text-teal-100/90">Display Settings</h5>
          <label class="block space-y-2">
            <span class="text-teal-200/80">Announcement message</span>
            <textarea id="adminAnnouncement" class="textarea-field" placeholder="Optional welcome or announcement..."></textarea>
          </label>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="block space-y-2">
              <span class="text-teal-200/80">Idle reset (seconds)</span>
              <input id="adminIdle" type="number" min="10" class="input-field" />
            </label>
            <label class="block space-y-2">
              <span class="text-teal-200/80">Highlight rotation (seconds)</span>
              <input id="adminHighlight" type="number" min="3" class="input-field" />
            </label>
          </div>
          <label class="block space-y-2">
            <span class="text-teal-200/80">Theme</span>
            <select id="adminTheme" class="select-field"></select>
          </label>
        </section>

        <section class="space-y-3 md:col-span-2">
          <div class="flex items-center justify-between">
            <h5 class="text-base font-semibold text-teal-100/90">Missions</h5>
            <button id="adminAddMission" class="btn btn-secondary touch">Add Mission</button>
          </div>
          <div class="text-teal-200/70 text-xs">Edit fields or reorder; changes apply after saving.</div>
          <div id="adminMissionList" class="space-y-3 max-h-[560px] overflow-y-auto pr-1"></div>
        </section>
        </div>
      </div>
    </div>
    </div>
  </div>

  <button id="oskShowBtn" type="button" class="hidden">Show Keyboard</button>
  <script type="module" src="scripts/main.js"></script>
  <!-- On-screen keyboard container -->
  <div id="osk" class="hidden fixed bottom-0 left-0 right-0 z-[60]"></div>
</body>
</html>
